# TFM Network Lab Platform

This repository brings together a full stack demo for an authenticated, browser-based network lab. It combines a React SPA, a Quarkus backend that brokers SSH over Apache Guacamole, a Keycloak IdP, and optional Containerlab topologies for FRR-based routers. Docker Compose spins up everything needed for local use, while `k8s-cloud/` and `tfm-terraform/` carry the early cloud/IaC work.

## What’s in the stack
- Frontend (`frontend/`): React (create-react-app) SPA with Keycloak auth, xterm.js terminals, lab catalog pages, and WebSocket consoles that talk to the backend.
- Backend (`backend/`): Quarkus services that mint short-lived WS tickets, enforce per-user lab-time quotas, expose `/api/*` identity/usage endpoints, and proxy SSH via `/ws/sshterm/{node}` or Guacamole via `/ws/tunnel`.
- Guacamole services: `guacd` plus the optional Guacamole web UI (`guacamole` service) backed by Postgres; schema is generated by the `guacdb-init` one-shot container.
- Identity: Keycloak realm `tfm` with a sample user `labuser` / `Passw0rd!` and admin bootstrap `admin` / `admin`.
- Labs: Containerlab topology in `clab-quickstart/` (three FRR routers r1–r3) the backend can reach over the `clab` Docker network. SSH defaults come from `SshTargetRegistry` or `GuacTunnelResource`.
- Ops artifacts: `k8s-cloud/` contains ArgoCD app-of-apps definitions; `tfm-terraform/` holds Terraform scaffolding; `guac-react/` is an experimental Vite/React Guacamole client.

## Repository layout
- `docker-compose.yaml` – full local stack (Keycloak, Guacamole, Postgres, backend, frontend, demo SSHD).
- `backend/` – Quarkus sources (`org.acme.*`), configuration in `src/main/resources/application.properties`, Maven wrapper, Dockerfile.
- `frontend/` – React SPA, xterm-based consoles, Keycloak integration hooks, Nginx Dockerfile for production.
- `clab-quickstart/` – Containerlab lab (`clab-bgp01.clab.yml`) plus FRR configs and init script.
- `keycloak/` and `keycloak-theme/` – realm export and custom theme Docker build.
- `k8s-cloud/` – ArgoCD application definitions for cloud deployments.
- `tfm-terraform/` – Infrastructure-as-code placeholder.
- `guac-react/` – alternative front-end experiment.

## Quick start with Docker Compose
1) Prerequisites: Docker/Compose. If you want live lab nodes, install Containerlab and deploy `clab-quickstart/clab-bgp01.clab.yml`, or at least create the shared network once: `docker network create clab`.
2) Bring up the stack: `docker compose up -d` (from repo root). The `guacdb-init` job seeds the Guacamole schema, then Postgres/guacd/Keycloak/backend/frontend start.
3) Endpoints:
   - Frontend SPA: http://localhost:8088
   - Backend (optional direct): http://localhost:8081
   - Keycloak: http://localhost:8082 (realm `tfm`, admin `admin`/`admin`, user `labuser`/`Passw0rd!`)
   - Guacamole UI (optional): http://localhost:8089/guacamole
4) SSH targets: backend defaults to `sshd` service (`user` / `password`, port 2222). For lab nodes, Containerlab exposes `clab-bgp01-r1|r2|r3` on the `clab` network; the SPA links route `/ws/sshterm/{node}` accordingly.
5) Stopping/cleanup: `docker compose down` (add `-v` to drop DB volumes).

## Developer workflow
- Backend: `cd backend && ./mvnw quarkus:dev -Ddebug=false` (override guacd/SSH hosts with `APP_GUACD_HOST`, `APP_SSH_HOST`, etc. matching `@ConfigProperty` keys). Uses Keycloak OIDC; defaults point at http://localhost:8082.
- Frontend: `cd frontend && npm install && npm start`. Optional overrides: `REACT_APP_KEYCLOAK_URL`, `REACT_APP_KEYCLOAK_REALM`, `REACT_APP_KEYCLOAK_CLIENT_ID`, `REACT_APP_API_BASE`.
- Tickets & quotas: the SPA calls `/api/ws-ticket` to mint a short-lived ticket, then opens `/ws/sshterm/{node}?ticket=...`. Usage caps are defined in `lab.usage.*` properties and can be overridden via `/api/usage/override`.
- Labs: deploy `clab-quickstart/clab-bgp01.clab.yml` to get FRR nodes reachable from the backend. Console pages under `/labs` map node IDs to those hostnames.

## Notes and next steps
- The external Docker network `clab` must exist for lab nodes; remove it from `docker-compose.yaml` if you only need the demo SSHD.
- Keycloak realm import happens on first boot; wipe the `keycloak` volume if you need a clean import.
- K8s/ArgoCD and Terraform directories are stubs/early drafts; tailor them before production use.

